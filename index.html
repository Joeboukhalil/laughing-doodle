<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Fast Image Outline Tool</title>
<style>
  body{
    font-family:Arial;
    background:#111;
    color:#eee;
    padding:20px;
  }
  canvas{
    background:#000;
    margin-top:15px;
    border-radius:8px;
  }
  button{
    padding:8px 12px;
    border:0;
    background:#4ade80;
    font-weight:bold;
    border-radius:6px;
    cursor:pointer;
  }
</style>
</head>
<body>

<h2>Fast Image â†’ Outline</h2>

<input type="file" id="file" accept="image/*">
<br><br>

<label>Edge Threshold</label>
<input type="range" id="threshold" min="10" max="200" value="60">
<span id="val">60</span>

<br><br>
<button onclick="makeOutline()">Process</button>
<button onclick="downloadPNG()">Download PNG</button>

<br>
<canvas id="canvas"></canvas>

<script>
let img = new Image();
let loaded = false;

document.getElementById("file").onchange = function(e){
  let f = e.target.files[0];
  if(!f) return;
  let url = URL.createObjectURL(f);

  img.onload = () => {
    loaded = true;

    // Resize big images to max 800
    const max = 800;
    const ratio = Math.min(1, max / Math.max(img.width, img.height));

    const canvas = document.getElementById("canvas");
    canvas.width = img.width * ratio;
    canvas.height = img.height * ratio;

    const ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  };

  img.src = url;
};

document.getElementById("threshold").oninput = function(){
  document.getElementById("val").innerText = this.value;
};

function makeOutline(){
  if(!loaded){
    alert("Upload an image first");
    return;
  }

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  let w = canvas.width;
  let h = canvas.height;

  let imgData = ctx.getImageData(0,0,w,h);
  let d = imgData.data;

  // convert to grayscale
  let gray = new Uint8ClampedArray(w*h);
  for(let i=0,j=0;i<d.length;i+=4,j++){
    gray[j] = 0.299*d[i] + 0.587*d[i+1] + 0.114*d[i+2];
  }

  // Sobel
  const out = new Uint8ClampedArray(w*h*4);
  const th = parseInt(document.getElementById("threshold").value);

  for(let y=1;y<h-1;y++){
    for(let x=1;x<w-1;x++){
      const i = y*w + x;
      const gx = (
        -gray[(y-1)*w + (x-1)] -2*gray[y*w + (x-1)] -gray[(y+1)*w + (x-1)]
        +gray[(y-1)*w + (x+1)] +2*gray[y*w + (x+1)] +gray[(y+1)*w + (x+1)]
      );
      const gy = (
        -gray[(y-1)*w + (x-1)] -2*gray[(y-1)*w + x] -gray[(y-1)*w + (x+1)]
        +gray[(y+1)*w + (x-1)] +2*gray[(y+1)*w + x] +gray[(y+1)*w + (x+1)]
      );

      const mag = Math.sqrt(gx*gx + gy*gy);

      const o = i*4;
      const v = mag > th ? 255 : 0;

      out[o] = v;
      out[o+1] = v;
      out[o+2] = v;
      out[o+3] = 255;
    }
  }

  ctx.putImageData(new ImageData(out, w, h), 0, 0);
}

function downloadPNG(){
  const canvas = document.getElementById("canvas");
  const link = document.createElement("a");
  link.download = "outline.png";
  link.href = canvas.toDataURL();
  link.click();
}
</script>
</body>
</html>